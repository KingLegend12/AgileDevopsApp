{"ast":null,"code":"import _objectSpread from\"/Users/drissjd/Desktop/AgileProject/agile_frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _regeneratorRuntime from\"/Users/drissjd/Desktop/AgileProject/agile_frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/drissjd/Desktop/AgileProject/agile_frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _objectWithoutProperties from\"/Users/drissjd/Desktop/AgileProject/agile_frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectWithoutProperties\";var _excluded=[\"children\"];import React,{useEffect}from\"react\";import{useSelector,useDispatch}from\"react-redux\";import{Route,Redirect}from\"react-router-dom\";import{loginSuccess}from\"../login/Login.Slice\";import{getUserProfile}from\"../../pages/dashboard/userAction\";import{fetchNewAccessJWT}from\"../../api/userApi\";import{DefaultLayout}from\"../../layout/DefaultLayout\";import{jsx as _jsx}from\"react/jsx-runtime\";export var PrivateRoute=function PrivateRoute(_ref){var children=_ref.children,rest=_objectWithoutProperties(_ref,_excluded);var dispatch=useDispatch();var _useSelector=useSelector(function(state){return state.login;}),isAuth=_useSelector.isAuth;var _useSelector2=useSelector(function(state){return state.user;}),user=_useSelector2.user;useEffect(function(){var updateAccessJWT=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var result;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return fetchNewAccessJWT();case 2:result=_context.sent;result&&dispatch(loginSuccess());case 4:case\"end\":return _context.stop();}}},_callee);}));return function updateAccessJWT(){return _ref2.apply(this,arguments);};}();!user._id&&dispatch(getUserProfile());!sessionStorage.getItem(\"accessJWT\")&&localStorage.getItem(\"crmSite\")&&updateAccessJWT();!isAuth&&sessionStorage.getItem(\"accessJWT\")&&dispatch(loginSuccess());},[dispatch,isAuth,user._id]);return/*#__PURE__*/_jsx(Route,_objectSpread(_objectSpread({},rest),{},{render:function render(_ref3){var location=_ref3.location;return isAuth?/*#__PURE__*/_jsx(DefaultLayout,{children:children}):/*#__PURE__*/_jsx(Redirect,{to:{pathname:\"/\",state:{from:location}}});}}));};","map":{"version":3,"sources":["/Users/drissjd/Desktop/AgileProject/agile_frontend/src/components/private-route/PrivateRoute.comp.js"],"names":["React","useEffect","useSelector","useDispatch","Route","Redirect","loginSuccess","getUserProfile","fetchNewAccessJWT","DefaultLayout","PrivateRoute","children","rest","dispatch","state","login","isAuth","user","updateAccessJWT","result","_id","sessionStorage","getItem","localStorage","location","pathname","from"],"mappings":"+sBAAA,MAAOA,CAAAA,KAAP,EAAgBC,SAAhB,KAAiC,OAAjC,CACA,OAASC,WAAT,CAAsBC,WAAtB,KAAyC,aAAzC,CACA,OAASC,KAAT,CAAgBC,QAAhB,KAAgC,kBAAhC,CACA,OAASC,YAAT,KAA6B,sBAA7B,CACA,OAASC,cAAT,KAA+B,kCAA/B,CAEA,OAASC,iBAAT,KAAkC,mBAAlC,CAEA,OAASC,aAAT,KAA8B,4BAA9B,C,2CAEA,MAAO,IAAMC,CAAAA,YAAY,CAAG,QAAfA,CAAAA,YAAe,MAA2B,IAAxBC,CAAAA,QAAwB,MAAxBA,QAAwB,CAAXC,IAAW,0CACrD,GAAMC,CAAAA,QAAQ,CAAGV,WAAW,EAA5B,CACA,iBAAmBD,WAAW,CAAC,SAACY,KAAD,QAAWA,CAAAA,KAAK,CAACC,KAAjB,EAAD,CAA9B,CAAQC,MAAR,cAAQA,MAAR,CACA,kBAAiBd,WAAW,CAAC,SAACY,KAAD,QAAWA,CAAAA,KAAK,CAACG,IAAjB,EAAD,CAA5B,CAAQA,IAAR,eAAQA,IAAR,CAEAhB,SAAS,CAAC,UAAM,CACd,GAAMiB,CAAAA,eAAe,2FAAG,oKACDV,CAAAA,iBAAiB,EADhB,QAChBW,MADgB,eAEtBA,MAAM,EAAIN,QAAQ,CAACP,YAAY,EAAb,CAAlB,CAFsB,sDAAH,kBAAfY,CAAAA,eAAe,2CAArB,CAKA,CAACD,IAAI,CAACG,GAAN,EAAaP,QAAQ,CAACN,cAAc,EAAf,CAArB,CAEA,CAACc,cAAc,CAACC,OAAf,CAAuB,WAAvB,CAAD,EACEC,YAAY,CAACD,OAAb,CAAqB,SAArB,CADF,EAEEJ,eAAe,EAFjB,CAIA,CAACF,MAAD,EAAWK,cAAc,CAACC,OAAf,CAAuB,WAAvB,CAAX,EAAkDT,QAAQ,CAACP,YAAY,EAAb,CAA1D,CACD,CAbQ,CAaN,CAACO,QAAD,CAAWG,MAAX,CAAmBC,IAAI,CAACG,GAAxB,CAbM,CAAT,CAeA,mBACE,KAAC,KAAD,gCACMR,IADN,MAEE,MAAM,CAAE,0BAAGY,CAAAA,QAAH,OAAGA,QAAH,OACNR,CAAAA,MAAM,cACJ,KAAC,aAAD,WAAgBL,QAAhB,EADI,cAGJ,KAAC,QAAD,EACE,EAAE,CAAE,CACFc,QAAQ,CAAE,GADR,CAEFX,KAAK,CAAE,CAAEY,IAAI,CAAEF,QAAR,CAFL,CADN,EAJI,EAFV,GADF,CAiBD,CArCM","sourcesContent":["import React, { useEffect } from \"react\";\nimport { useSelector, useDispatch } from \"react-redux\";\nimport { Route, Redirect } from \"react-router-dom\";\nimport { loginSuccess } from \"../login/Login.Slice\";\nimport { getUserProfile } from \"../../pages/dashboard/userAction\";\n\nimport { fetchNewAccessJWT } from \"../../api/userApi\";\n\nimport { DefaultLayout } from \"../../layout/DefaultLayout\";\n\nexport const PrivateRoute = ({ children, ...rest }) => {\n  const dispatch = useDispatch();\n  const { isAuth } = useSelector((state) => state.login);\n  const { user } = useSelector((state) => state.user);\n\n  useEffect(() => {\n    const updateAccessJWT = async () => {\n      const result = await fetchNewAccessJWT();\n      result && dispatch(loginSuccess());\n    };\n\n    !user._id && dispatch(getUserProfile());\n\n    !sessionStorage.getItem(\"accessJWT\") &&\n      localStorage.getItem(\"crmSite\") &&\n      updateAccessJWT();\n\n    !isAuth && sessionStorage.getItem(\"accessJWT\") && dispatch(loginSuccess());\n  }, [dispatch, isAuth, user._id]);\n\n  return (\n    <Route\n      {...rest}\n      render={({ location }) =>\n        isAuth ? (\n          <DefaultLayout>{children}</DefaultLayout>\n        ) : (\n          <Redirect\n            to={{\n              pathname: \"/\",\n              state: { from: location },\n            }}\n          />\n        )\n      }\n    />\n  );\n};\n"]},"metadata":{},"sourceType":"module"}